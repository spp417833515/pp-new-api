# 🔄 "Neuro-Link" Synchronization Protocol (神经链路同步协议)

本工作流旨在解决**“代码与图谱脱节”**的问题。
无论是**新项目初始化**，还是**既有代码的变更**，必须强制同步至 PPDocs MCP，确保 AI 的记忆永远是最新的。

---

### 1.第一阶段：差异嗅探 (Delta Recognition) 📡
🔹 **核心目标**：识别代码现实与图谱记忆之间的偏差。
✏️ **动作**：
*   **扫描代码库**：检测新增文件、修改的函数、重构的类。
*   **查询图谱**：读取 PPDocs 当前状态。
*   **计算差异**：生成 `Diff Report` (例如：代码有 Function A，图谱里没有)。
× **禁区**：
*   禁止忽略任何细微的逻辑变更。
*   禁止在未对比图谱的情况下盲目写入。

### 2.第二阶段：语义映射 (Semantic Mapping) 🧠
🔹 **核心目标**：将冰冷的代码翻译为可视化的知识节点。
✏️ **动作**：
*   **逻辑提取**：AI 阅读代码，提炼核心业务逻辑（非逐行翻译，而是意译）。
*   **节点定义**：将逻辑转换为 PPDocs 的 `Node` (节点) 和 `Document` (文档) 格式。
*   **关系构建**：确定新节点与旧节点之间的连线 (Edge/Relationship)。
× **禁区**：
*   禁止生成无意义的节点（如 "Variable X changed"）。
*   必须通过节点连线体现代码的模块化关系。

### 3.第三阶段：图谱注入 (Graph Injection) 💉
🔹 **核心目标**：调用 MCP 接口，实施持久化存储。
✏️ **动作**：
*   **PPDocs 调用**：使用 MCP 工具执行增删改操作 (CRUD)。
    *   `Create_Node`: 新增模块。
    *   `Update_Link`: 变更逻辑依赖。
    *   `Delete_Node`: 清除废弃代码的幽灵节点。
*   **原子化提交**：确保每次同步都是完整的，不会留下“断头”节点。
× **禁区**：
*   禁止手动修改数据，必须通过 MCP 工具。
*   禁止产生孤立节点 (Orphan Nodes)。

### 4.第四阶段：记忆回溯验证 (Memory Re-check) 🛡️
🔹 **核心目标**：确保 AI 真的“记住”了。
✏️ **动作**：
*   **反向查询**：向 PPDocs 提问刚才更新的逻辑。
*   **一致性校验**：如果 PPDocs 的回答与代码逻辑一致，标记为 ✅ Synced。
*   **可视化确认**：输出 ASCII 或 Mermaid 结构图供人类确认。

---

### 📊 同步逻辑可视化图解 (ASCII)

```text
       +-------------------------+
       |  💻 代码变更 / 新项目启动 |
       +-----------+-------------+
                   |
                   v
       +-----------+-------------+
       |  📡 差异嗅探 (Sniffer)   | <---- PPDocs Current State
       +-----------+-------------+
                   |
                   v
           /-------+-------\
          /   存在偏差?     \
         v                   v
   (🚫 NO: 结束)         (❗ YES: 需要同步)
                           |
                           v
                 +---------+---------+
                 |  🧠 语义映射分析   |
                 | (Code -> Knowledge)|
                 +---------+---------+
                           |
                           v
                 +---------+---------+
                 |  💉 PPDocs 注入    |
                 | (Call MCP Tools)  |
                 +---------+---------+
                           |
                           v
                 +---------+---------+
                 |  🛡️ 记忆回溯验证   |
                 +---------+---------+
                           |
               /-----------+----------\
              /    AI能否准确复述?     \
             v                          v
     +-------+-------+          +-------+-------+
     | ✅ 同步完成    |          | ❌ 失败重试    |
     | (Persistent)  |          | (Retry Loop)  |
     +---------------+          +---------------+
