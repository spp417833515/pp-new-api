# 🔍 "Deep-Trace" Diagnostic Protocol (深层溯源诊断协议)

核心理念：**先在宏观地图（图谱）上定位，再在微观战场（代码）上排查，绝不盲目翻看代码。**

---

### 1.第一阶段：知识锚定 (Knowledge Anchoring) ⚓️
🔹 **核心目标**：在动手之前，通过 PPDocs 明确“正确应该是什么样”。
✏️ **动作**：
*   **查询图谱**：输入问题关键词，提取标准业务逻辑。
*   **建立基准**：以图谱中的描述作为“真理标准 (Truth)”。
× **禁区**：
*   禁止在未查询图谱前，直接跳入代码库阅读（防止陷入细节泥潭）。

### 2.第二阶段：抽象映射 (Abstract Mapping) 🗺️
🔹 **核心目标**：利用链式思维 (CoT)，绘制高层级逻辑流。
✏️ **动作**：
*   **绘制流程**：忽略实现细节，仅画出模块间的输入/输出流转（数据流）。
*   **可视化**：生成 ASCII 或 Mermaid 流程图，展示当前链路。
*   **标记疑点**：在流程图上圈出逻辑可能断裂的节点。

### 3.第三阶段：靶点锁定 (Target Locking) 🎯
🔹 **核心目标**：将问题范围从“整个项目”缩小到“单一节点”。
✏️ **动作**：
*   **定位区域**：确定问题具体发生在 PPDocs 的哪个 `Node`（节点）或 `Edge`（连线）上。
*   **隔离上下文**：只关注该节点的前置依赖（Pre-requisites）和后置影响（Post-effects）。

### 4.第三阶段：双层取证 (Dual-Layer Forensics) 🕵️
🔹 **核心目标**：对比“理论（图谱）”与“现实（代码）”的差异。
✏️ **动作**：
*   **左眼看图谱**：阅读 PPDocs 中该节点的逻辑定义。
*   **右眼看代码**：审查该节点对应的实际代码实现。
*   **寻找裂痕**：
    *   🔴 **代码错误 (Bug)**：图谱逻辑正确，代码实现错误。
    *   🟠 **设计缺陷 (Design Flaw)**：代码符合图谱，但结果依然错误（图谱本身逻辑有误）。
    *   🟡 **文档脱节 (Sync Issue)**：代码逻辑正确且有效，但图谱未记载（需同步）。

### 5.第五阶段：分析结案 (Verdict) 📝
🔹 **核心目标**：输出可执行的诊断报告。
✏️ **动作**：
*   输出标准化的**《问题诊断报告》**。
*   **流转**：将报告作为输入，传递给 **[任务方案生成工作流]** 进行修复。

---

### 📊 诊断逻辑可视化图解 (ASCII)

```text
       +-------------------------+
       |   🚨 问题触发 (Issue)    |
       +------------+------------+
                    |
                    v
       +------------+------------+
       |  ⚓️ 知识锚定 (PPDocs)   | <--- 获取标准逻辑 (Truth)
       +------------+------------+
                    |
                    v
           [ 🗺️ 抽象逻辑层 ]
       +-------------------------+
       |   Step1 -> Step2 ...    | (绘制链式流程)
       |           |             |
       |         [ ? ] <---------+--- 🎯 锁定可疑节点
       +-----------+-------------+
                   |
                   v
       +-----------+-------------+
       |  🕵️ 双层取证 (Compare)   |
       +-----+-------------+-----+
             |             |
       (📜 PPDocs) vs (💻 Code)
             |             |
             +------+------+
                    |
                    v
            /-------+-------\
           /    根本原因?    \
          v                   v
  +--------------+     +--------------+
  | 🐛 代码 Bug   |     | 📐 设计/文档错 |
  | (Fix Code)   |     | (Fix Graph)  |
  +--------------+     +--------------+
